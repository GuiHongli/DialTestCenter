# æƒé™ç®¡ç†ç³»ç»Ÿè¯´æ˜æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† DialTestCenter é¡¹ç›®çš„æƒé™ç®¡ç†ç³»ç»Ÿè®¾è®¡ã€å®ç°å’Œä½¿ç”¨æ–¹æ³•ã€‚è¯¥ç³»ç»Ÿé‡‡ç”¨åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ¨¡å¼ï¼Œå®ç°äº†ç»†ç²’åº¦çš„æƒé™ç®¡ç†ï¼Œæ”¯æŒæ™ºèƒ½ç¼“å­˜å’Œå®æ—¶æƒé™æ›´æ–°ã€‚

## ğŸ¯ è®¾è®¡ç›®æ ‡

- **é¡¹ç›®åŠ è½½æ—¶è·å–æƒé™**: åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è·å–ç”¨æˆ·æ‰€æœ‰è§’è‰²å’Œæƒé™ä¿¡æ¯
- **é¡µé¢è®¿é—®å¼€æ”¾**: æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®æ‰€æœ‰é¡µé¢ï¼Œä¸é™åˆ¶é¡µé¢è®¿é—®
- **æ“ä½œæƒé™æ§åˆ¶**: æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€æ§åˆ¶æ“ä½œæŒ‰é’®çš„æ˜¾ç¤º/éšè—
- **æƒé™å®æ—¶ç”Ÿæ•ˆ**: æƒé™å˜æ›´åè‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°é¡µé¢
- **æ™ºèƒ½ç¼“å­˜æœºåˆ¶**: åŸºäºusernameçš„æ™ºèƒ½ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### åç«¯æ¶æ„

```
UserRoleController
â”œâ”€â”€ userRolesPermissionGet()     # è·å–ç”¨æˆ·æƒé™ä¿¡æ¯
â”œâ”€â”€ userRolesPost()              # åˆ›å»ºç”¨æˆ·è§’è‰²
â”œâ”€â”€ userRolesIdPut()             # æ›´æ–°ç”¨æˆ·è§’è‰²
â”œâ”€â”€ userRolesIdDelete()          # åˆ é™¤ç”¨æˆ·è§’è‰²
â””â”€â”€ userRolesRolesGet()          # è·å–æ‰€æœ‰è§’è‰²å®šä¹‰
```

### å‰ç«¯æ¶æ„

```
PermissionProvider (Context)
â”œâ”€â”€ usePermission Hook           # æƒé™ç®¡ç†æ ¸å¿ƒ Hook
â”œâ”€â”€ PagePermission ç»„ä»¶          # é¡µé¢æƒé™æ§åˆ¶ç»„ä»¶
â”œâ”€â”€ RolePermission ç»„ä»¶          # è§’è‰²æƒé™æ§åˆ¶ç»„ä»¶
â””â”€â”€ æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ                 # åŸºäºusernameçš„ç¼“å­˜ç®¡ç†
```

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. åç«¯å®ç°

#### API æ¥å£

**æ¥å£è·¯å¾„**: `GET /dialingtest/api/user-roles/permission`

**è¯·æ±‚å¤´**:
```
X-Username: admin
Cache-Control: no-cache
Pragma: no-cache
```

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "data": {
    "username": "admin",
    "roles": ["ADMIN"],
    "pagePermissions": {
      "user-management": {
        "hasAccess": true,
        "operations": ["create", "edit", "delete", "view"]
      },
      "test-case-set": {
        "hasAccess": true,
        "operations": ["upload", "download", "delete", "view"]
      },
      "user-role-management": {
        "hasAccess": true,
        "operations": ["create", "edit", "delete", "view"]
      }
    }
  },
  "message": "è·å–ç”¨æˆ·æƒé™ä¿¡æ¯æˆåŠŸ"
}
```

#### æƒé™é…ç½®

```java
// ç”¨æˆ·ç®¡ç†é¡µé¢æƒé™
UserPermissionResponseDataPagePermissions userManagementPerms = new UserPermissionResponseDataPagePermissions();
userManagementPerms.setHasAccess(true); // æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®é¡µé¢
if (userRoles.contains("ADMIN")) {
    userManagementPerms.setOperations(Arrays.asList("create", "edit", "delete", "view"));
} else {
    userManagementPerms.setOperations(Arrays.asList("view"));
}
pagePermissions.put("user-management", userManagementPerms);

// ç”¨ä¾‹é›†ç®¡ç†é¡µé¢æƒé™
UserPermissionResponseDataPagePermissions testCaseSetPerms = new UserPermissionResponseDataPagePermissions();
testCaseSetPerms.setHasAccess(true); // æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½è®¿é—®é¡µé¢
if (userRoles.contains("ADMIN") || userRoles.contains("OPERATOR")) {
    testCaseSetPerms.setOperations(Arrays.asList("upload", "download", "delete", "view"));
} else if (userRoles.contains("BROWSER")) {
    testCaseSetPerms.setOperations(Arrays.asList("download", "view"));
} else {
    testCaseSetPerms.setOperations(Arrays.asList("view"));
}
pagePermissions.put("test-case-set", testCaseSetPerms);
```

### 2. å‰ç«¯å®ç°

#### æƒé™ç®¡ç† Hook

```typescript
// hooks/usePermission.ts
export const usePermission = (): PermissionContextType => {
  const context = useContext(PermissionContext);
  if (context === undefined) {
    throw new Error('usePermission must be used within a PermissionProvider');
  }
  return context;
};

// æƒé™æ£€æŸ¥æ–¹æ³•
const hasRole = useCallback((role: string): boolean => {
  return userPermission?.roles.includes(role) || false;
}, [userPermission]);

const hasPagePermission = useCallback((pageId: string, operation?: string): boolean => {
  if (!userPermission) return false;
  
  const pagePermission = userPermission.pagePermissions[pageId];
  if (!pagePermission) return false;
  
  if (!operation) return pagePermission.hasAccess;
  
  return pagePermission.operations.includes(operation);
}, [userPermission]);
```

#### æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ

```typescript
// æ™ºèƒ½ç¼“å­˜æ£€æŸ¥é€»è¾‘
const cachedPermission = sessionStorage.getItem('userPermission');
const cachedTime = sessionStorage.getItem('userPermissionTime');
const cachedUsername = sessionStorage.getItem('userPermissionUsername');
const currentUsername = getXUsernameFromCookie();
const now = new Date().getTime();
const cacheExpiry = 5 * 60 * 1000; // 5åˆ†é’Ÿ

// æ£€æŸ¥æ¡ä»¶ï¼šç¼“å­˜å­˜åœ¨ + æœªè¿‡æœŸ + usernameæœªå˜åŒ–
if (cachedPermission && cachedTime && cachedUsername && 
    (now - parseInt(cachedTime)) < cacheExpiry && 
    cachedUsername === currentUsername) {
  // ä½¿ç”¨ç¼“å­˜
  const parsed = JSON.parse(cachedPermission);
  setUserPermission(parsed);
  return;
}

// å¦‚æœusernameå‘ç”Ÿå˜åŒ–ï¼Œæ¸…é™¤æ—§ç¼“å­˜
if (cachedUsername && cachedUsername !== currentUsername) {
  sessionStorage.removeItem('userPermission');
  sessionStorage.removeItem('userPermissionTime');
  sessionStorage.removeItem('userPermissionUsername');
}
```

#### æƒé™æ§åˆ¶ç»„ä»¶

```typescript
// é¡µé¢æƒé™ç»„ä»¶
export const PagePermission: React.FC<PagePermissionProps> = ({ 
  pageId, 
  operation, 
  children, 
  fallback = null 
}) => {
  const { hasPagePermission } = usePermission();
  
  const hasPermission = hasPagePermission(pageId, operation);
  
  return hasPermission ? <>{children}</> : <>{fallback}</>;
};

// è§’è‰²æƒé™ç»„ä»¶
export const RolePermission: React.FC<RolePermissionProps> = ({ 
  roles, 
  children, 
  fallback = null, 
  requireAll = false 
}) => {
  const { hasAnyRole, hasAllRoles } = usePermission();
  
  const hasPermission = requireAll ? hasAllRoles(roles) : hasAnyRole(roles);
  
  return hasPermission ? <>{children}</> : <>{fallback}</>;
};
```

#### è‡ªåŠ¨æƒé™æ›´æ–°æœºåˆ¶

```typescript
// ç›‘å¬cookieå˜åŒ–ï¼Œæ£€æµ‹usernameå˜åŒ–
useEffect(() => {
  const checkUsernameChange = () => {
    const currentUsername = getXUsernameFromCookie();
    const cachedUsername = sessionStorage.getItem('userPermissionUsername');
    
    if (cachedUsername && cachedUsername !== currentUsername) {
      console.log('æ£€æµ‹åˆ°cookieä¸­usernameå˜åŒ–ï¼Œè‡ªåŠ¨åˆ·æ–°æƒé™:', cachedUsername, '->', currentUsername);
      refreshPermission();
    }
  };

  // å®šæœŸæ£€æŸ¥cookieå˜åŒ–ï¼ˆæ¯30ç§’ï¼‰
  const interval = setInterval(checkUsernameChange, 30000);
  
  // ç›‘å¬storageäº‹ä»¶ï¼ˆè·¨æ ‡ç­¾é¡µåŒæ­¥ï¼‰
  const handleStorageChange = (e: StorageEvent) => {
    if (e.key === 'userPermissionUsername' && e.newValue !== e.oldValue) {
      console.log('æ£€æµ‹åˆ°å…¶ä»–æ ‡ç­¾é¡µusernameå˜åŒ–ï¼Œåˆ·æ–°æƒé™');
      refreshPermission();
    }
  };

  window.addEventListener('storage', handleStorageChange);

  return () => {
    clearInterval(interval);
    window.removeEventListener('storage', handleStorageChange);
  };
}, [refreshPermission]);
```

## ğŸ“Š è§’è‰²æƒé™é…ç½®

### è§’è‰²å®šä¹‰

| è§’è‰² | ä¸­æ–‡åç§° | æƒé™æè¿° |
|------|----------|----------|
| ADMIN | ç®¡ç†å‘˜ | æ‹¥æœ‰æ‰€æœ‰æƒé™ |
| OPERATOR | æ“ä½œå‘˜ | å¯ä»¥æ“ä½œç”¨ä¾‹é›†ï¼Œä¸èƒ½ç®¡ç†ç”¨æˆ· |
| BROWSER | æµè§ˆè€… | åªèƒ½æŸ¥çœ‹å’Œä¸‹è½½ |
| EXECUTOR | æ‰§è¡Œæœº | æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ |

### é¡µé¢æƒé™çŸ©é˜µ

| é¡µé¢ | ADMIN | OPERATOR | BROWSER | EXECUTOR |
|------|-------|----------|---------|----------|
| **ç”¨æˆ·ç®¡ç†** | | | | |
| - æŸ¥çœ‹ | âœ… | âœ… | âœ… | âœ… |
| - æ–°å¢ | âœ… | âŒ | âŒ | âŒ |
| - ç¼–è¾‘ | âœ… | âŒ | âŒ | âŒ |
| - åˆ é™¤ | âœ… | âŒ | âŒ | âŒ |
| **ç”¨ä¾‹é›†ç®¡ç†** | | | | |
| - æŸ¥çœ‹ | âœ… | âœ… | âœ… | âœ… |
| - ä¸Šä¼  | âœ… | âœ… | âŒ | âŒ |
| - ä¸‹è½½ | âœ… | âœ… | âœ… | âœ… |
| - ç¼–è¾‘ | âœ… | âœ… | âŒ | âŒ |
| - åˆ é™¤ | âœ… | âœ… | âŒ | âŒ |
| **ç”¨æˆ·è§’è‰²ç®¡ç†** | | | | |
| - æŸ¥çœ‹ | âœ… | âœ… | âœ… | âœ… |
| - æ–°å¢ | âœ… | âŒ | âŒ | âŒ |
| - ç¼–è¾‘ | âœ… | âŒ | âŒ | âŒ |
| - åˆ é™¤ | âœ… | âŒ | âŒ | âŒ |

## ğŸ¨ ä½¿ç”¨æŒ‡å—

### 1. åº”ç”¨é›†æˆ

```typescript
// App.tsx
import { PermissionProvider } from './hooks/usePermission';

function App() {
  return (
    <I18nProvider>
      <PermissionProvider>
        <Layout>
          <Routes>
            {/* è·¯ç”±é…ç½® */}
          </Routes>
        </Layout>
      </PermissionProvider>
    </I18nProvider>
  );
}
```

### 2. ç»„ä»¶ä¸­ä½¿ç”¨æƒé™æ§åˆ¶

#### åŸºç¡€æƒé™æ£€æŸ¥

```typescript
const UserManagement = () => {
  const { hasPagePermission, hasRole } = usePermission();
  
  return (
    <div>
      {/* æ ¹æ®æƒé™æ˜¾ç¤ºæŒ‰é’® */}
      {hasPagePermission('user-management', 'create') && (
        <Button onClick={handleAdd}>æ–°å¢ç”¨æˆ·</Button>
      )}
      
      {hasRole('ADMIN') && (
        <Button onClick={handleDelete}>åˆ é™¤ç”¨æˆ·</Button>
      )}
    </div>
  );
};
```

#### ä½¿ç”¨æƒé™æ§åˆ¶ç»„ä»¶

```typescript
const UserManagement = () => {
  return (
    <div>
      {/* é¡µé¢æƒé™æ§åˆ¶ */}
      <PagePermission pageId="user-management" operation="create">
        <Button onClick={handleAdd}>æ–°å¢ç”¨æˆ·</Button>
      </PagePermission>
      
      {/* è§’è‰²æƒé™æ§åˆ¶ */}
      <RolePermission roles={['ADMIN']}>
        <Button onClick={handleDelete}>åˆ é™¤ç”¨æˆ·</Button>
      </RolePermission>
    </div>
  );
};
```

#### è¡¨æ ¼æ“ä½œåˆ—æƒé™æ§åˆ¶

```typescript
const UserTable = () => {
  const { hasPagePermission } = usePermission();
  
  const columns = [
    { title: 'ç”¨æˆ·å', dataIndex: 'username' },
    { title: 'è§’è‰²', dataIndex: 'role' },
  ];
  
  // æ ¹æ®æƒé™æ·»åŠ æ“ä½œåˆ—
  if (hasPagePermission('user-management', 'edit') || 
      hasPagePermission('user-management', 'delete')) {
    columns.push({
      title: 'æ“ä½œ',
      key: 'action',
      render: (record: User) => (
        <Space>
          <PagePermission pageId="user-management" operation="edit">
            <Button onClick={() => handleEdit(record)}>ç¼–è¾‘</Button>
          </PagePermission>
          <PagePermission pageId="user-management" operation="delete">
            <Button danger onClick={() => handleDelete(record)}>åˆ é™¤</Button>
          </PagePermission>
        </Space>
      ),
    });
  }
  
  return <Table columns={columns} dataSource={users} />;
};
```

### 3. æƒé™ç¼“å­˜æœºåˆ¶

#### æ™ºèƒ½ç¼“å­˜ç­–ç•¥

```typescript
// ç¼“å­˜å­˜å‚¨
sessionStorage.setItem('userPermission', JSON.stringify(permission));
sessionStorage.setItem('userPermissionTime', timestamp.toString());
sessionStorage.setItem('userPermissionUsername', currentUsername);

// ç¼“å­˜æ£€æŸ¥
const cachedPermission = sessionStorage.getItem('userPermission');
const cachedTime = sessionStorage.getItem('userPermissionTime');
const cachedUsername = sessionStorage.getItem('userPermissionUsername');
const currentUsername = getXUsernameFromCookie();

// ç¼“å­˜æ¡ä»¶ï¼šå­˜åœ¨ + æœªè¿‡æœŸ + usernameæœªå˜åŒ–
if (cachedPermission && cachedTime && cachedUsername && 
    (now - parseInt(cachedTime)) < cacheExpiry && 
    cachedUsername === currentUsername) {
  // ä½¿ç”¨ç¼“å­˜
}
```

#### æƒé™åˆ·æ–°æœºåˆ¶

```typescript
// å¼ºåˆ¶åˆ·æ–°æƒé™
const refreshPermission = useCallback(async () => {
  // æ¸…é™¤æ‰€æœ‰ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°è·å–
  sessionStorage.removeItem('userPermission');
  sessionStorage.removeItem('userPermissionTime');
  sessionStorage.removeItem('userPermissionUsername');
  console.log('æ¸…é™¤æƒé™ç¼“å­˜ï¼Œå¼ºåˆ¶é‡æ–°è·å–');
  await fetchUserPermission();
}, [fetchUserPermission]);
```

## ğŸ”„ æƒé™ç®¡ç†æµç¨‹

### 1. åº”ç”¨å¯åŠ¨æµç¨‹

```mermaid
graph TD
    A[åº”ç”¨å¯åŠ¨] --> B[PermissionProvider åˆå§‹åŒ–]
    B --> C[æ£€æŸ¥cookieä¸­xUsername]
    C --> D[æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ]
    D --> E{ç¼“å­˜æœ‰æ•ˆ?}
    E -->|æ˜¯| F[ä½¿ç”¨ç¼“å­˜æƒé™]
    E -->|å¦| G[è°ƒç”¨APIè·å–æƒé™]
    G --> H[æ›´æ–°æƒé™çŠ¶æ€]
    H --> I[ç¼“å­˜æƒé™ä¿¡æ¯]
    F --> J[æ¸²æŸ“åº”ç”¨ç•Œé¢]
    I --> J
```

### 2. æƒé™æ£€æŸ¥æµç¨‹

```mermaid
graph TD
    A[ç”¨æˆ·æ“ä½œ] --> B[æƒé™æ£€æŸ¥]
    B --> C{æœ‰æƒé™?}
    C -->|æ˜¯| D[æ‰§è¡Œæ“ä½œ]
    C -->|å¦| E[æ˜¾ç¤ºæ— æƒé™æç¤º]
    D --> F[æ“ä½œå®Œæˆ]
    E --> F
```

### 3. æƒé™æ›´æ–°æµç¨‹

```mermaid
graph TD
    A[ä¿®æ”¹cookieä¸­xUsername] --> B[æ£€æµ‹usernameå˜åŒ–]
    B --> C[æ¸…é™¤æ—§ç¼“å­˜]
    C --> D[é‡æ–°è·å–æƒé™]
    D --> E[æ›´æ–°æƒé™çŠ¶æ€]
    E --> F[ç•Œé¢æƒé™æ§åˆ¶ç”Ÿæ•ˆ]
    F --> G[è·¨æ ‡ç­¾é¡µåŒæ­¥]
```

### 4. è‡ªåŠ¨æ£€æµ‹æµç¨‹

```mermaid
graph TD
    A[å®šæ—¶æ£€æŸ¥] --> B[å¯¹æ¯”å½“å‰usernameä¸ç¼“å­˜username]
    B --> C{usernameå˜åŒ–?}
    C -->|æ˜¯| D[è‡ªåŠ¨åˆ·æ–°æƒé™]
    C -->|å¦| E[ç»§ç»­ä½¿ç”¨ç¼“å­˜]
    D --> F[æ›´æ–°æ‰€æœ‰æ ‡ç­¾é¡µ]
    E --> G[ç­‰å¾…ä¸‹æ¬¡æ£€æŸ¥]
    F --> G
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### 1. æ·»åŠ æ–°é¡µé¢æƒé™

#### åç«¯é…ç½®

```java
// åœ¨ UserRoleController.java ä¸­æ·»åŠ æ–°é¡µé¢æƒé™
UserPermissionResponseDataPagePermissions newPagePerms = new UserPermissionResponseDataPagePermissions();
newPagePerms.setHasAccess(true);
if (userRoles.contains("ADMIN")) {
    newPagePerms.setOperations(Arrays.asList("create", "edit", "delete", "view"));
} else {
    newPagePerms.setOperations(Arrays.asList("view"));
}
pagePermissions.put("new-page", newPagePerms);
```

#### å‰ç«¯ä½¿ç”¨

```typescript
// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨æ–°é¡µé¢æƒé™
const NewPage = () => {
  return (
    <div>
      <PagePermission pageId="new-page" operation="create">
        <Button>æ–°å¢</Button>
      </PagePermission>
      
      <PagePermission pageId="new-page" operation="edit">
        <Button>ç¼–è¾‘</Button>
      </PagePermission>
    </div>
  );
};
```

### 2. æ·»åŠ æ–°è§’è‰²

#### åç«¯é…ç½®

```java
// 1. åœ¨æ•°æ®åº“ä¸­æ·»åŠ æ–°è§’è‰²
// 2. åœ¨æƒé™é…ç½®ä¸­æ·»åŠ æ–°è§’è‰²é€»è¾‘
if (userRoles.contains("NEW_ROLE")) {
    newPagePerms.setOperations(Arrays.asList("view", "custom_operation"));
}
```

#### å‰ç«¯ä½¿ç”¨

```typescript
// ä½¿ç”¨æ–°è§’è‰²æƒé™
<RolePermission roles={['NEW_ROLE']}>
  <Button>æ–°è§’è‰²ä¸“ç”¨æ“ä½œ</Button>
</RolePermission>
```

### 3. è°ƒè¯•æƒé™é—®é¢˜

```typescript
// åœ¨ç»„ä»¶ä¸­æ·»åŠ æƒé™è°ƒè¯•ä¿¡æ¯
const DebugComponent = () => {
  const { userPermission, hasPagePermission } = usePermission();
  
  console.log('å½“å‰ç”¨æˆ·æƒé™:', userPermission);
  console.log('æ˜¯å¦æœ‰åˆ›å»ºæƒé™:', hasPagePermission('user-management', 'create'));
  
  return <div>è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°æ§åˆ¶å°</div>;
};
```

### 4. æƒé™APIè°ƒè¯•

```typescript
// æƒé™APIè¯·æ±‚è°ƒè¯•ä¿¡æ¯
console.log('æƒé™APIè¯·æ±‚é…ç½®:', {
  url: `/dialingtest/api/user-roles/permission?t=${timestamp}`,
  headers: headers,
  xUsername: headers['X-Username'],
  cookies: document.cookie
});

// æƒé™APIå“åº”è°ƒè¯•ä¿¡æ¯
console.log('æƒé™APIå“åº”æ•°æ®:', result);

// æƒé™åŠ è½½è°ƒè¯•ä¿¡æ¯
console.log('æƒé™ä¿¡æ¯å·²åŠ è½½:', {
  username: userPermission.username,
  roles: userPermission.roles,
  pagePermissions: userPermission.pagePermissions
});
```

## ğŸ“‹ æœ€ä½³å®è·µ

### 1. æƒé™æ£€æŸ¥åŸåˆ™

- **æœ€å°æƒé™åŸåˆ™**: é»˜è®¤ä¸ç»™æƒé™ï¼Œéœ€è¦æ—¶å†æˆäºˆ
- **æƒé™åˆ†ç¦»**: é¡µé¢è®¿é—®æƒé™å’Œæ“ä½œæƒé™åˆ†ç¦»
- **æ™ºèƒ½ç¼“å­˜**: åŸºäºusernameçš„æ™ºèƒ½ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚
- **æƒé™éªŒè¯**: å‰åç«¯éƒ½è¦è¿›è¡Œæƒé™éªŒè¯

### 2. ç»„ä»¶è®¾è®¡åŸåˆ™

- **æƒé™ç»„ä»¶åŒ–**: ä½¿ç”¨æƒé™æ§åˆ¶ç»„ä»¶ï¼Œé¿å…é‡å¤ä»£ç 
- **æƒé™å£°æ˜å¼**: é€šè¿‡ç»„ä»¶å±æ€§å£°æ˜æƒé™éœ€æ±‚
- **æƒé™å¯è¯»æ€§**: æƒé™æ§åˆ¶é€»è¾‘æ¸…æ™°æ˜“æ‡‚

### 3. æ€§èƒ½ä¼˜åŒ–

- **æ™ºèƒ½ç¼“å­˜**: ä½¿ç”¨åŸºäºusernameçš„æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- **æŒ‰éœ€åŠ è½½**: åªåœ¨éœ€è¦æ—¶è¿›è¡Œæƒé™æ£€æŸ¥
- **æ‰¹é‡æ£€æŸ¥**: é¿å…é¢‘ç¹çš„å•ä¸ªæƒé™æ£€æŸ¥
- **è‡ªåŠ¨æ›´æ–°**: è‡ªåŠ¨æ£€æµ‹usernameå˜åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°

### 4. ç¼“å­˜ç­–ç•¥

- **ç¼“å­˜æ—¶é—´**: 5åˆ†é’Ÿç¼“å­˜è¿‡æœŸæ—¶é—´
- **ç¼“å­˜é”®**: åŒ…å«usernameä¿¡æ¯ï¼Œç¡®ä¿ç”¨æˆ·éš”ç¦»
- **è‡ªåŠ¨æ¸…ç†**: usernameå˜åŒ–æ—¶è‡ªåŠ¨æ¸…é™¤æ—§ç¼“å­˜
- **è·¨æ ‡ç­¾é¡µ**: æ”¯æŒå¤šæ ‡ç­¾é¡µæƒé™åŒæ­¥

## ğŸš¨ æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨æ³¨æ„äº‹é¡¹

- **åç«¯éªŒè¯**: å‰ç«¯æƒé™æ§åˆ¶åªæ˜¯UIå±‚é¢çš„ï¼Œåç«¯å¿…é¡»è¿›è¡Œæƒé™éªŒè¯
- **æƒé™æ³„éœ²**: ä¸è¦åœ¨å®¢æˆ·ç«¯æš´éœ²æ•æ„Ÿæƒé™ä¿¡æ¯
- **æƒé™ç»•è¿‡**: ç¡®ä¿ç”¨æˆ·æ— æ³•ç»•è¿‡å‰ç«¯æƒé™æ§åˆ¶

### 2. å¼€å‘æ³¨æ„äº‹é¡¹

- **æƒé™ä¸€è‡´æ€§**: ç¡®ä¿å‰åç«¯æƒé™é€»è¾‘ä¸€è‡´
- **æƒé™æµ‹è¯•**: å……åˆ†æµ‹è¯•å„ç§æƒé™ç»„åˆ
- **æƒé™æ–‡æ¡£**: åŠæ—¶æ›´æ–°æƒé™é…ç½®æ–‡æ¡£
- **APIè·¯å¾„**: ä½¿ç”¨æ­£ç¡®çš„APIè·¯å¾„ `/dialingtest/api/user-roles/permission`

### 3. ç»´æŠ¤æ³¨æ„äº‹é¡¹

- **æƒé™å®¡è®¡**: å®šæœŸå®¡è®¡æƒé™é…ç½®
- **æƒé™æ¸…ç†**: åŠæ—¶æ¸…ç†æ— ç”¨çš„æƒé™é…ç½®
- **æƒé™ç›‘æ§**: ç›‘æ§æƒé™ä½¿ç”¨æƒ…å†µ
- **ç¼“å­˜ç®¡ç†**: å®šæœŸæ£€æŸ¥ç¼“å­˜æœºåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œ

### 4. å¸¸è§é—®é¢˜

#### Cookieé—®é¢˜
- **Cookieä¸å­˜åœ¨**: ç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ `admin`
- **Cookieå˜åŒ–**: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶æ›´æ–°æƒé™
- **Cookieæ ¼å¼**: ç¡®ä¿cookieæ ¼å¼æ­£ç¡® `xUsername=value`

#### ç¼“å­˜é—®é¢˜
- **ç¼“å­˜è¿‡æœŸ**: 5åˆ†é’Ÿåè‡ªåŠ¨é‡æ–°è·å–
- **ç¼“å­˜æ¸…ç†**: usernameå˜åŒ–æ—¶è‡ªåŠ¨æ¸…ç†
- **ç¼“å­˜åŒæ­¥**: å¤šæ ‡ç­¾é¡µè‡ªåŠ¨åŒæ­¥

#### APIé—®é¢˜
- **è·¯å¾„é”™è¯¯**: ä½¿ç”¨æ­£ç¡®è·¯å¾„ `/dialingtest/api/user-roles/permission`
- **å“åº”æ ¼å¼**: ç¡®ä¿è¿”å›JSONæ ¼å¼ï¼Œä¸æ˜¯HTML
- **è¯·æ±‚å¤´**: ç¡®ä¿åŒ…å« `X-Username` å¤´

## ğŸ”§ æ•…éšœæ’é™¤

### 1. æƒé™ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰æƒé™APIè¯·æ±‚
2. æ£€æŸ¥APIå“åº”æ˜¯å¦ä¸ºJSONæ ¼å¼
3. æ£€æŸ¥cookieä¸­xUsernameæ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// å¼ºåˆ¶åˆ·æ–°æƒé™
const { refreshPermission } = usePermission();
refreshPermission();
```

### 2. æƒé™ç¼“å­˜é—®é¢˜

**æ£€æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥sessionStorageä¸­çš„æƒé™æ•°æ®
2. æ£€æŸ¥usernameæ˜¯å¦å˜åŒ–
3. æ£€æŸ¥ç¼“å­˜æ—¶é—´æ˜¯å¦è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**:
```javascript
// æ‰‹åŠ¨æ¸…é™¤ç¼“å­˜
sessionStorage.removeItem('userPermission');
sessionStorage.removeItem('userPermissionTime');
sessionStorage.removeItem('userPermissionUsername');
```

### 3. APIè¯·æ±‚å¤±è´¥

**æ£€æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨
3. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// æ£€æŸ¥APIè·¯å¾„
console.log('APIè·¯å¾„:', '/dialingtest/api/user-roles/permission');

// æ£€æŸ¥è¯·æ±‚å¤´
console.log('è¯·æ±‚å¤´:', headers);
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [API æ¥å£æ–‡æ¡£](./api-documentation.md)
- [å‰ç«¯ç»„ä»¶æ–‡æ¡£](./component-documentation.md)
- [æ•°æ®åº“è®¾è®¡æ–‡æ¡£](./database-design.md)
- [éƒ¨ç½²æŒ‡å—](./deployment-guide.md)

## ğŸ”— ç›¸å…³é“¾æ¥

- [é¡¹ç›®ä»“åº“](https://github.com/your-org/DialTestCenter)
- [åœ¨çº¿æ¼”ç¤º](https://demo.dialtestcenter.com)
- [é—®é¢˜åé¦ˆ](https://github.com/your-org/DialTestCenter/issues)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æœ€åæ›´æ–°**: 2024-01-XX  
**ç»´æŠ¤äººå‘˜**: å¼€å‘å›¢é˜Ÿ

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0 (2024-01-XX)
- âœ… ä¿®å¤æƒé™APIè·¯å¾„é—®é¢˜
- âœ… å®ç°æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- âœ… æ·»åŠ usernameå˜åŒ–è‡ªåŠ¨æ£€æµ‹
- âœ… æ”¯æŒè·¨æ ‡ç­¾é¡µæƒé™åŒæ­¥
- âœ… ä¼˜åŒ–é”™è¯¯å¤„ç†å’Œè°ƒè¯•ä¿¡æ¯
- âœ… å®Œå–„æƒé™ç®¡ç†æµç¨‹æ–‡æ¡£

### v1.0 (2024-01-XX)
- âœ… åŸºç¡€æƒé™ç®¡ç†ç³»ç»Ÿ
- âœ… è§’è‰²æƒé™é…ç½®
- âœ… é¡µé¢æƒé™æ§åˆ¶
- âœ… æƒé™ç¼“å­˜æœºåˆ¶