## 1 需求重述
### 1.2 需求背景
拨测脚本执行时，其依赖的软件包必须提前安装好，那么需要提前管理需要的软件包。
### 1.3 需求功能介绍
此次需要的的软件包，主要为手机上的APP安装包，涉及Android和ios系统。
需要实现以下功能。
1）设置中增加菜单“软件包管理”，支持软件包的列表呈现、上传、下载、删除
2）页面上传软件包，上传方式如下：
-- 上传zip包，zip包中包含多个安装包
-- 上传单个安装包
-- 上传多个安装包
2）解析上传的软件包,将文件名（带后缀）解析为软件名，将文件名、sha512、file_content存入数据库


## 2 功能实现分析
### 2.1 功能点清单
#### 2.2 功能点1：软件包管理数据库设计
##### 详细描述
**数据库表设计：**
```sql
CREATE TABLE software_package (
    id BIGSERIAL PRIMARY KEY,
    software_name VARCHAR(200) NOT NULL,
    file_name VARCHAR(255) NOT NULL,
    file_content BYTEA NOT NULL,
    file_format VARCHAR(10) NOT NULL,
    sha512 VARCHAR(128),
    platform VARCHAR(20) NOT NULL,
    creator VARCHAR(100) NOT NULL,
    file_size BIGINT NOT NULL,
    description VARCHAR(1000),
    version VARCHAR(50),
    created_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**字段说明：**
- `id`: 主键，自增长
- `software_name`: 软件名称（从文件名解析）
- `file_name`: 原始文件名（带后缀）
- `file_content`: 文件内容（二进制数据）
- `file_format`: 文件格式（apk或ipa）
- `sha512`: 文件内容的SHA512哈希值
- `platform`: 平台（android或ios）
- `creator`: 创建者
- `file_size`: 文件大小（字节）
- `description`: 描述信息
- `version`: 软件版本（从文件名解析）

#### 2.3 功能点2：软件包上传功能
##### 详细描述
**支持的上传方式：**
1. 单个软件包上传（APK/IPA文件）
2. ZIP包批量上传（包含多个APK/IPA文件）

**上传流程：**
```
1. 文件格式验证（.apk, .ipa, .zip）
2. 文件大小检查（单个文件≤500MB，ZIP包≤1GB）
3. 文件名解析（提取软件名和版本）
4. 重复性检查（文件名和SHA512）
5. 文件内容计算SHA512哈希值
6. 数据库存储
7. 返回上传结果
```

**核心算法：**
```java
// 文件名解析算法
String[] nameParts = softwareName.split("_");
if (nameParts.length >= 2) {
    softwareName = nameParts[0];
    version = nameParts[nameParts.length - 1];
} else {
    version = "1.0.0"; // 默认版本
}
```

#### 2.4 功能点3：软件包查询和列表展示
##### 详细描述
**查询功能：**
- 分页查询（支持页码和每页大小）
- 平台过滤（Android/iOS）
- 创建者过滤
- 软件名称模糊搜索
- 按创建时间倒序排列

**列表展示字段：**
- 软件名称和文件名
- 平台标识（Android/iOS图标）
- 版本号
- 文件大小（MB显示）
- 创建者和创建时间
- 操作按钮（下载、编辑、删除）

#### 2.5 功能点4：软件包下载功能
##### 详细描述
**下载流程：**
```
1. 根据ID查询软件包信息
2. 验证软件包存在性
3. 设置正确的Content-Type
4. 设置下载文件名
5. 返回文件流
```

**Content-Type设置：**
- APK文件：`application/vnd.android.package-archive`
- IPA文件：`application/octet-stream`

#### 2.6 功能点5：软件包删除功能
##### 详细描述
**删除流程：**
```
1. 验证软件包ID有效性
2. 检查软件包是否存在
3. 执行数据库删除操作
4. 返回删除结果
```

**安全措施：**
- 删除前确认提示
- 记录删除操作日志
- 支持批量删除（前端实现）

#### 2.7 功能点6：软件包信息编辑功能
##### 详细描述
**可编辑字段：**
- 软件名称
- 版本号
- 描述信息

**编辑流程：**
```
1. 获取当前软件包信息
2. 显示编辑表单
3. 验证输入数据
4. 更新数据库记录
5. 返回更新结果
```

#### 2.8 功能点7：统计信息展示
##### 详细描述
**统计维度：**
- Android软件包数量
- iOS软件包数量
- 总软件包数量

**展示方式：**
- 卡片式统计展示
- 实时数据更新
- 支持按平台筛选

### 2.9 技术架构设计
#### 后端架构
```
Controller层 -> Service层 -> Repository层 -> Database
     ↓              ↓              ↓
  REST API      业务逻辑      数据访问
```

**核心类设计：**
- `SoftwarePackage`: 实体类
- `SoftwarePackageRepository`: 数据访问接口
- `SoftwarePackageService`: 业务逻辑服务
- `SoftwarePackageController`: REST控制器

#### 前端架构
```
Page -> Component -> Service -> API
  ↓         ↓         ↓
页面组件   业务组件   服务层
```

**核心组件：**
- `SoftwarePackageManagement`: 主管理组件
- `SoftwarePackageService`: 前端服务类
- 类型定义：`SoftwarePackage`等TypeScript接口
## 3 AR开发者测试设计
### 3.1 测试对象分析
**被测对象：**
- `SoftwarePackage` 实体类
- `SoftwarePackageService` 服务类
- `SoftwarePackageController` 控制器类
- `SoftwarePackageRepository` 数据访问接口

### 3.2 测试用例设计
#### 3.2.1 SoftwarePackage实体类测试
**测试方法：** `SoftwarePackageTest`

| 测试用例ID | 测试方法 | 测试场景 | 预期结果 |
|-----------|---------|---------|---------|
| TC001 | testDefaultConstructor | 测试默认构造函数 | 创建空对象，所有字段为null |
| TC002 | testParameterizedConstructor | 测试带参构造函数 | 正确设置所有字段值 |
| TC003 | testGettersAndSetters | 测试getter/setter方法 | 正确获取和设置字段值 |
| TC004 | testEquals | 测试equals方法 | 相同对象返回true，不同对象返回false |
| TC005 | testHashCode | 测试hashCode方法 | 相同对象hashCode相等 |
| TC006 | testToString | 测试toString方法 | 返回包含所有字段信息的字符串 |
| TC007 | testNullValues | 测试null值处理 | 正确处理null值 |

#### 3.2.2 SoftwarePackageService服务类测试
**测试方法：** `SoftwarePackageServiceTest`

| 测试用例ID | 测试方法 | 测试场景 | 预期结果 |
|-----------|---------|---------|---------|
| TC101 | testGetSoftwarePackages_Success | 成功获取软件包列表 | 返回分页数据 |
| TC102 | testGetSoftwarePackages_WithFilters | 带过滤条件查询 | 返回过滤后的数据 |
| TC103 | testGetSoftwarePackageById_Success | 根据ID获取软件包 | 返回指定软件包 |
| TC104 | testGetSoftwarePackageById_NotFound | 获取不存在的软件包 | 返回空Optional |
| TC105 | testUploadSoftwarePackage_APK_Success | 上传APK文件成功 | 返回保存的软件包 |
| TC106 | testUploadSoftwarePackage_IPA_Success | 上传IPA文件成功 | 返回保存的软件包 |
| TC107 | testUploadSoftwarePackage_EmptyFile | 上传空文件 | 抛出IllegalArgumentException |
| TC108 | testUploadSoftwarePackage_UnsupportedFormat | 上传不支持格式 | 抛出IllegalArgumentException |
| TC109 | testUploadSoftwarePackage_FileTooLarge | 上传过大文件 | 抛出IllegalArgumentException |
| TC110 | testUploadSoftwarePackage_FileNameExists | 上传重复文件名 | 抛出IllegalArgumentException |
| TC111 | testUploadSoftwarePackage_SHA512Exists | 上传重复内容文件 | 抛出IllegalArgumentException |
| TC112 | testDeleteSoftwarePackage_Success | 删除软件包成功 | 成功删除 |
| TC113 | testDeleteSoftwarePackage_NotFound | 删除不存在的软件包 | 抛出IllegalArgumentException |
| TC114 | testUpdateSoftwarePackage_Success | 更新软件包成功 | 返回更新后的软件包 |
| TC115 | testUpdateSoftwarePackage_NotFound | 更新不存在的软件包 | 抛出IllegalArgumentException |
| TC116 | testGetPlatformStatistics | 获取平台统计信息 | 返回统计数据 |
| TC117 | testUploadZipPackage_Success | 上传ZIP包成功 | 返回软件包列表 |
| TC118 | testUploadZipPackage_NotZipFile | 上传非ZIP文件 | 抛出IllegalArgumentException |
| TC119 | testUploadZipPackage_FileTooLarge | 上传过大ZIP文件 | 抛出IllegalArgumentException |

#### 3.2.3 SoftwarePackageController控制器测试
**测试方法：** `SoftwarePackageControllerTest`

| 测试用例ID | 测试方法 | 测试场景 | 预期结果 |
|-----------|---------|---------|---------|
| TC201 | testGetSoftwarePackages_Success | 成功获取软件包列表 | 返回200状态码和分页数据 |
| TC202 | testGetSoftwarePackages_WithFilters | 带过滤条件查询 | 返回200状态码和过滤数据 |
| TC203 | testGetSoftwarePackages_InvalidParameters | 无效参数查询 | 返回400状态码 |
| TC204 | testGetSoftwarePackage_Success | 获取软件包详情成功 | 返回200状态码和软件包数据 |
| TC205 | testGetSoftwarePackage_NotFound | 获取不存在的软件包 | 返回404状态码 |
| TC206 | testUploadSoftwarePackage_Success | 上传软件包成功 | 返回200状态码和成功消息 |
| TC207 | testUploadSoftwarePackage_InvalidFile | 上传无效文件 | 返回400状态码和错误消息 |
| TC208 | testUploadSoftwarePackage_IOException | 上传IO异常 | 返回500状态码和错误消息 |
| TC209 | testUploadZipPackage_Success | 上传ZIP包成功 | 返回200状态码和成功消息 |
| TC210 | testUploadZipPackage_InvalidFile | 上传无效ZIP文件 | 返回400状态码和错误消息 |
| TC211 | testDownloadSoftwarePackage_Success | 下载软件包成功 | 返回200状态码和文件流 |
| TC212 | testDownloadSoftwarePackage_NotFound | 下载不存在的软件包 | 返回404状态码 |
| TC213 | testDeleteSoftwarePackage_Success | 删除软件包成功 | 返回204状态码 |
| TC214 | testDeleteSoftwarePackage_NotFound | 删除不存在的软件包 | 返回404状态码 |
| TC215 | testUpdateSoftwarePackage_Success | 更新软件包成功 | 返回200状态码和更新数据 |
| TC216 | testUpdateSoftwarePackage_InvalidParameters | 更新无效参数 | 返回400状态码 |
| TC217 | testGetStatistics_Success | 获取统计信息成功 | 返回200状态码和统计数据 |
| TC218 | testGetStatistics_Error | 获取统计信息失败 | 返回500状态码和错误消息 |

### 3.3 测试因子分析
**文件格式因子：**
- APK文件（.apk）
- IPA文件（.ipa）
- ZIP文件（.zip）

**文件大小因子：**
- 正常大小（< 500MB）
- 边界大小（500MB）
- 超大文件（> 500MB）

**平台因子：**
- Android平台
- iOS平台

**文件名格式因子：**
- 标准格式（软件名_版本.扩展名）
- 无版本格式（软件名.扩展名）
- 多下划线格式（软件名_其他_版本.扩展名）

### 3.4 测试覆盖率要求
- **语句覆盖率：** ≥ 90%
- **分支覆盖率：** ≥ 85%
- **方法覆盖率：** 100%
- **类覆盖率：** 100%

### 3.5 测试执行策略
1. **单元测试：** 使用JUnit 4 + Mockito框架
2. **集成测试：** 使用Spring Boot Test框架
3. **API测试：** 使用MockMvc进行REST API测试
4. **数据库测试：** 使用H2内存数据库进行测试

### 3.6 测试数据准备
**正常测试数据：**
- 标准APK文件：`TestApp_1.0.0.apk`
- 标准IPA文件：`TestApp_1.0.0.ipa`
- 包含多个APK的ZIP文件：`packages.zip`

**异常测试数据：**
- 空文件
- 超大文件
- 不支持格式文件
- 损坏的ZIP文件